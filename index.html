<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìÅ PROJETOS - iectta (mod)</title>
<style>
  body {font-family: Arial, sans-serif; background:#f5f7fa; color:#333; margin:0; padding:20px; transition:background .3s,color .3s,filter .3s;}
  h1 {margin:0; font-size:1.4rem;}
  .section {background:#fff; border-radius:10px; padding:20px; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-bottom:20px;}
  table {width:100%; border-collapse:collapse; margin-top:10px;}
  th, td {padding:8px; border-bottom:1px solid #ddd; text-align:left;}
  tr.selected {background:#cce5ff;}
  input[type=text], textarea, select {width:100%; padding:6px; border-radius:6px; border:1px solid #ccc;}
  button {padding:8px 12px; border:none; border-radius:6px; background:#0077cc; color:#fff; cursor:pointer; margin:4px;}
  button:hover {background:#005fa3;}
  .dark {background:#1e1f22; color:#ddd;}
  .dark .section{background:#2c2d31; box-shadow:none;}
  .dark input,.dark textarea,.dark select{background:#3a3b3f; color:#eee; border:1px solid #555;}
  .dark table th,.dark table td{border-color:#444;}
  .topbar {display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; flex-wrap:wrap;}
  .btn-group {display:flex; gap:6px; flex-wrap:wrap;}
  #keyModal {position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.45); display:flex; justify-content:center; align-items:center; z-index:1000;}
  #keyBox {background:#fff; padding:30px; border-radius:10px; text-align:center; box-shadow:0 2px 10px rgba(0,0,0,0.3); max-width:320px; width:90%; z-index:1100;}
  #keyInput {width:100%; padding:10px; border-radius:6px; border:1px solid #ccc; margin-top:10px;}
  #contentWrapper.locked {filter:blur(6px);}
  #statusbar {text-align:center; font-size:14px; padding:6px; border-radius:6px; background:#0077cc; color:white; opacity:0; transition:opacity 0.6s;}
  .dark #statusbar{background:#005fa3;}
</style>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
<div id="contentWrapper">
  <div class="topbar">
    <h1>üìÅ PROJETOS - iectta</h1>
    <div class="btn-group">
      <button onclick="toggleDarkMode()">üåó Modo</button>
      <a href="/admin/" style="text-decoration:none;"><button>‚öôÔ∏è Gerenciar Conte√∫do</button></a>
      
      
    </div>
  </div>
  <div id="statusbar"></div>
  <p style="text-align:center;">Sistema criptografado de gest√£o e acompanhamento de projetos institucionais</p>

  <div class="section">
    <h2>üìã Projetos</h2>
    <table id="projectsTable">
      <thead><tr><th>Projeto</th><th>Descri√ß√£o</th><th>Participante</th><th>Fun√ß√µes</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>

    <h3>Adicionar / Editar Projeto</h3>
    <input type="text" id="projInput" placeholder="Nome do Projeto">
    <textarea id="descInput" placeholder="Descri√ß√£o do Projeto"></textarea>
    <input type="text" id="partInput" placeholder="Participante">
    <input type="text" id="funcInput" placeholder="Fun√ß√µes ou Responsabilidades">
    <select id="statusInput">
      <option>Idea</option><option>Planning</option><option>Prototype</option>
      <option>Testing</option><option>Deploying</option><option>Live</option><option>Finished</option>
    </select>
    <div>
      <button onclick="addOrUpdateProject()">‚ûï Adicionar</button>
      <button onclick="editSelected()">‚úèÔ∏è Editar</button>
      <button onclick="deleteSelected()">üóëÔ∏è Apagar</button>
    </div>
  </div>

  <div class="section" style="text-align:center;">
    <h2>üì¶ Gerenciar Dados (Local)</h2>
    <button onclick="resetDatabase()">üßπ Resetar Dados Locais</button>
    <p>Para salvar mudan√ßas no Git, use o painel de Gerenciamento de Conte√∫do.</p>
  </div>


<script>
let projetos=[], selectedIndex=null, editMode=false;
const tableBody=document.querySelector('#projectsTable tbody');
const DB_KEY='dados_projetos_encrypted.json'; // File to load from Git

function showStatus(msg){
  const sb=document.getElementById('statusbar');
  sb.textContent=msg; sb.style.opacity=1;
  clearTimeout(sb.timer);
  sb.timer=setTimeout(()=>sb.style.opacity=0,4000);
}



function renderTable(){
  tableBody.innerHTML='';
  projetos.forEach((p,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${p.projeto}</td><td>${p.descricao}</td><td>${p.participante}</td><td>${p.funcoes}</td><td>${p.status}</td>`;
    if(i===selectedIndex)tr.classList.add('selected');
    tr.onclick=()=>selectRow(i);
    tableBody.appendChild(tr);
  });
}
function selectRow(i){selectedIndex=i;renderTable();showStatus(`üü¶ Projeto selecionado: ${projetos[i].projeto}`);}
function addOrUpdateProject(){
  const projeto=document.getElementById('projInput').value.trim(),descricao=document.getElementById('descInput').value.trim(),participante=document.getElementById('partInput').value.trim(),funcoes=document.getElementById('funcInput').value.trim(),status=document.getElementById('statusInput').value;
  if(!projeto)return alert('Informe o nome do projeto.');
  const newEntry={projeto,descricao,participante,funcoes,status};
  if(editMode && selectedIndex!=null){projetos[selectedIndex]=newEntry;showStatus(`‚úèÔ∏è Projeto atualizado: ${projeto}`);}else{projetos.push(newEntry);showStatus(`‚úÖ Projeto adicionado: ${projeto}`);}
  editMode=false; selectedIndex=null;clearForm(); renderTable(); saveEncrypted();
}
function editSelected(){
  if(selectedIndex==null)return alert('Selecione um projeto.');
  const p=projetos[selectedIndex];
  document.getElementById('projInput').value=p.projeto;
  document.getElementById('descInput').value=p.descricao;
  document.getElementById('partInput').value=p.participante;
  document.getElementById('funcInput').value=p.funcoes;
  document.getElementById('statusInput').value=p.status;
  editMode=true;showStatus(`‚úèÔ∏è Editando projeto #${selectedIndex+1} (${p.projeto})`);
}
function deleteSelected(){
  if(selectedIndex==null)return alert('Selecione um projeto.');
  if(confirm('Apagar este projeto?')){const removed=projetos.splice(selectedIndex,1)[0];selectedIndex=null;renderTable();saveEncrypted();showStatus(`üóëÔ∏è Projeto removido: ${removed.projeto}`);}
}
function clearForm(){document.getElementById('projInput').value='';document.getElementById('descInput').value='';document.getElementById('partInput').value='';document.getElementById('funcInput').value='';document.getElementById('statusInput').value='Planning';}
// Removed saveEncrypted function. Data will be saved via Netlify CMS.

// Removed exportData function. Data will be managed by Netlify CMS.
// Removed importData function. Data will be managed by Netlify CMS.
function resetDatabase(){if(confirm('Apagar todos os dados locais?')){localStorage.removeItem('projetos');projetos=[];renderTable();showStatus('üßπ Banco de dados limpo');}}
function toggleDarkMode(){document.body.classList.toggle('dark');localStorage.setItem('darkMode',document.body.classList.contains('dark'));}
if(localStorage.getItem('darkMode')==='true')document.body.classList.add('dark');

// The site will now load the data from the JSON file via fetch, which is managed by Netlify CMS.
async function loadProjectsFromGit(){
  try {
    const response = await fetch(DB_KEY);
    if (!response.ok) throw new Error(\`Failed to fetch \${DB_KEY}\`);
    const data = await response.json();
    projetos = (data.projetos || []).map(p => p.status ? p : { ...p, status: 'Planning' });
    renderTable();
    showStatus('‚úÖ Dados carregados do Git com sucesso');
  } catch (error) {
    console.error('Erro ao carregar dados:', error);
    showStatus('‚ùå Erro ao carregar dados do Git.');
    // Fallback to local storage if Git data is unavailable
    const stored = localStorage.getItem('projetos');
    if (stored) {
      try {
        projetos = JSON.parse(stored);
        renderTable();
        showStatus('‚ö†Ô∏è Dados carregados do LocalStorage (falha no Git).');
      } catch {
        projetos = [];
        showStatus('‚ö†Ô∏è Dados do LocalStorage corrompidos. Novo banco criado.');
      }
    } else {
      projetos = [];
      showStatus('üÜï Novo banco de dados de projetos criado.');
    }
  }
}
window.addEventListener('load', loadProjectsFromGit);

// Client-side save is only for local testing/fallback. The primary save mechanism is the CMS.
function saveLocalFallback(){
  localStorage.setItem('projetos', JSON.stringify(projetos));
}

// Update addOrUpdateProject to save to local storage as a fallback
function addOrUpdateProject(){
  const projeto=document.getElementById('projInput').value.trim(),descricao=document.getElementById('descInput').value.trim(),participante=document.getElementById('partInput').value.trim(),funcoes=document.getElementById('funcInput').value.trim(),status=document.getElementById('statusInput').value;
  if(!projeto)return alert('Informe o nome do projeto.');
  const newEntry={projeto,descricao,participante,funcoes,status};
  if(editMode && selectedIndex!=null){projetos[selectedIndex]=newEntry;showStatus(`‚úèÔ∏è Projeto atualizado: ${projeto}`);}else{projetos.push(newEntry);showStatus(`‚úÖ Projeto adicionado: ${projeto}`);}
  editMode=false; selectedIndex=null;clearForm(); renderTable(); saveLocalFallback(); // Use local save fallback
}

function deleteSelected(){
  if(selectedIndex==null)return alert('Selecione um projeto.');
  if(confirm('Apagar este projeto?')){const removed=projetos.splice(selectedIndex,1)[0];selectedIndex=null;renderTable();saveLocalFallback();showStatus(`üóëÔ∏è Projeto removido: ${removed.projeto}`);} // Use local save fallback
}

// Remove old button listeners, the new button is a link to /admin/

</script>
</body>
</html>