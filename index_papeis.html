<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>papeis_iectta v12</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: var(--bg);
    color: var(--fg);
    margin: 0;
    padding: 0;
    transition: background-color .3s, color .3s;
  }
  :root {
    --bg: #0d1117;
    --fg: #e6edf3;
    --card: #161b22;
    --accent: #58a6ff;
  }
  body.light {
    --bg: #ffffff;
    --fg: #111111;
    --card: #f2f2f2;
    --accent: #0077ff;
  }
  header {
    display:flex;justify-content:space-between;align-items:center;
    padding:1rem 1.5rem;background-color:var(--card);
  }
  h1 {margin:0;font-size:1.3rem;}
  button,select,textarea,input {
    background-color:var(--card);
    color:var(--fg);
    border:1px solid var(--accent);
    border-radius:6px;
    padding:6px 10px;
    margin:4px;
  }
  button:hover {background-color:var(--accent);color:#fff;}
  textarea {width:100%;min-height:80px;}
  .container{padding:1rem;max-width:1000px;margin:auto;}
  .statusbar {
    position:fixed;bottom:0;left:0;right:0;
    background-color:var(--card);
    color:var(--fg);
    text-align:center;
    padding:.4rem;
    font-size:.9rem;
  }
  .list {margin-top:1rem;}
  .list-item {
    background-color:var(--card);
    padding:.7rem;
    border-radius:6px;
    margin-bottom:.5rem;
    cursor:pointer;
  }
  .highlight{border:1px solid var(--accent);}
</style>
</head>
<body>
<header>
  <h1>papeis_iectta v12</h1>
  <div>
    <button id="toggleTheme">üåó Tema</button>
    <a href="/admin/" style="text-decoration:none;"><button>‚öôÔ∏è Gerenciar Conte√∫do</button></a>
    
    
  </div>
</header>

<div class="container">
  <label>Fun√ß√£o:</label>
  <select id="funcaoSelect"></select><br/>
  <label>Escopo:</label>
  <select id="escopoSelect">
    <option>iectta</option>
    <option>Parceiro</option>
    <option>Colaborador</option>
    <option>Outro</option>
  </select><br/>
  <label>Status:</label>
  <select id="statusSelect">
    <option>Indefinido</option>
    <option>Existente</option>
    <option>Pr√©vio</option>
    <option>N√£o Existente</option>
    <option>Buscando</option>
    <option>Proposta Enviada</option>
    <option>Aguardando</option>
  </select>
  <h3>Descri√ß√£o</h3>
  <textarea id="descricao"></textarea>
  <h3>Tarefas</h3>
  <textarea id="tarefas"></textarea>
  <div>
    <button id="addBtn">‚ûï Adicionar</button>
    <button id="editBtn">‚úèÔ∏è Editar</button>
    <button id="deleteBtn">üóëÔ∏è Apagar</button>
    <button id="saveBtn">üíæ Salvar</button>
  </div>

  <div class="list" id="listContainer"></div>
</div>
<div class="statusbar" id="statusBar">Pronto.</div>

<script>
// ==== tema ====
const body=document.body;
const themeBtn=document.getElementById('toggleTheme');
body.classList.toggle('light',localStorage.getItem('theme')==='light');
themeBtn.onclick=()=>{body.classList.toggle('light');localStorage.setItem('theme',body.classList.contains('light')?'light':'dark');};

// ==== status ====
function status(msg){document.getElementById('statusBar').textContent=msg;}

// ==== base ====
let dados=[];
const DB_KEY_PAPEIS='dados_papeis_encrypted.json';

async function carregarDadosDoGit(){
  try{
    const r=await fetch(DB_KEY_PAPEIS);
    if (!r.ok) throw new Error(\`Failed to fetch \${DB_KEY_PAPEIS}\`);
    const j=await r.json();
    dados=j.dados_papeis||[];
    popularFuncoes();
    renderList();
    status('Dados carregados do Git com sucesso.');
  }catch(e){
    console.error('Erro ao carregar dados:', e);
    status('‚ùå Erro ao carregar dados do Git. A edi√ß√£o deve ser feita pelo CMS.');
  }
}
carregarDadosDoGit();

// ==== fun√ß√µes ====
function popularFuncoes(){
  const sel=document.getElementById('funcaoSelect');
  sel.innerHTML=dados.map(d=>`<option>${d['Fun√ß√£o']}</option>`).join('');
}

// ==== render ====
function renderList(){
  const list=document.getElementById('listContainer');
  list.innerHTML=dados.map((d,i)=>`<div class="list-item" onclick="selecionar(${i})">${d['Fun√ß√£o']}</div>`).join('');
}

// ==== sele√ß√£o ====
let selecionado=-1;
window.selecionar=(i)=>{
  selecionado=i;
  const d=dados[i];
  document.getElementById('funcaoSelect').value=d['Fun√ß√£o'];
  document.getElementById('descricao').value=d['Descri√ß√£o'];
  document.getElementById('tarefas').value=d['Tarefas'].join('\\n');
  status('Item selecionado: '+d['Fun√ß√£o']);
};

// ==== CRUD ====
document.getElementById('addBtn').onclick=()=>{
  const f=document.getElementById('funcaoSelect').value;
  const desc=document.getElementById('descricao').value;
  const tar=document.getElementById('tarefas').value.split(/\\n+/).filter(Boolean);
  dados.push({"Fun√ß√£o":f,"Descri√ß√£o":desc,"Tarefas":tar});
  renderList();status('Fun√ß√£o adicionada.');
};
document.getElementById('editBtn').onclick=()=>{
  if(selecionado<0)return;
  const f=document.getElementById('funcaoSelect').value;
  const desc=document.getElementById('descricao').value;
  const tar=document.getElementById('tarefas').value.split(/\\n+/).filter(Boolean);
  dados[selecionado]={"Fun√ß√£o":f,"Descri√ß√£o":desc,"Tarefas":tar};
  renderList();status('Fun√ß√£o editada.');
};
document.getElementById('deleteBtn').onclick=()=>{
  if(selecionado<0)return;
  dados.splice(selecionado,1);
  selecionado=-1;
  renderList();status('Fun√ß√£o removida.');
};
document.getElementById('saveBtn').onclick=()=>{
	  status('Aviso: O bot√£o Salvar localmente foi desativado. Use o Gerenciamento de Conte√∫do para salvar no Git.');
	};

// Export/Import functionality removed. Data is managed by Netlify CMS.

// Client-side encryption/decryption removed. Data is managed by Netlify CMS.
</script>
</body>
</html>
