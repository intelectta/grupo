<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üåê DIRE√á√ÉO - iectta</title>
<style>
  body {font-family: Arial, sans-serif; background:#f5f7fa; color:#333; margin:0; padding:20px; transition:background .3s,color .3s,filter .3s;}
  h1 {text-align:center; margin-bottom:10px;}
  h2 {margin-top:30px;}
  .section {background:#fff; border-radius:10px; padding:20px; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-bottom:20px;}
  table {width:100%; border-collapse:collapse; margin-top:10px;}
  th, td {padding:8px; border-bottom:1px solid #ddd; text-align:left;}
  input[type=text], textarea {width:100%; padding:6px; border-radius:6px; border:1px solid #ccc;}
  button {padding:8px 12px; border:none; border-radius:6px; background:#0077cc; color:#fff; cursor:pointer; margin:6px 4px 0 0;}
  button:hover {background:#005fa3;}
  .tools-grid {display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px; margin-top:15px;}
  .tool {background:#eef3f8; border-radius:10px; padding:12px; text-align:center;}
  .tool a {color:#0077cc; text-decoration:none; font-weight:bold;}
  .tool a:hover {text-decoration:underline;}
  small {display:block; color:#666; margin-top:6px;}
  .dark {background:#1e1f22; color:#ddd;}
  .dark .section{background:#2c2d31; box-shadow:none;}
  .dark input,.dark textarea{background:#3a3b3f; color:#eee; border:1px solid #555;}
  .dark table th,.dark table td{border-color:#444;}
  .topbar {display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;}
  #keyModal {
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.45); display:flex; justify-content:center; align-items:center;
    z-index:1000;
  }
  #keyBox {
    background:#fff; padding:30px; border-radius:10px; text-align:center; box-shadow:0 2px 10px rgba(0,0,0,0.3);
    max-width:320px; width:90%; z-index:1100;
  }
  #keyInput {width:100%; padding:10px; border-radius:6px; border:1px solid #ccc; margin-top:10px;}
  #contentWrapper.locked {filter:blur(6px);}
</style>
</head>
<body>

<div id="contentWrapper">
  <div class="topbar">
    <h1>üåê DIRE√á√ÉO - iectta</h1>
    <button onclick="toggleDarkMode()">üåó Modo Escuro/Claro</button>
    <a href="/admin/" style="text-decoration:none;"><button>‚öôÔ∏è Gerenciar Conte√∫do</button></a>
  </div>
  <p style="text-align:center;">Sistema colaborativo criptografado de acompanhamento institucional</p>

  <div class="section">
    <h2>üë• Participantes</h2>
    <table id="participantsTable">
      <thead><tr><th>Nome</th><th>Fun√ß√£o / Papel</th><th>Observa√ß√µes</th></tr></thead>
      <tbody></tbody>
    </table>

    <h3>Adicionar Participante</h3>
    <input type="text" id="nameInput" placeholder="Nome">
    <input type="text" id="roleInput" placeholder="Fun√ß√£o ou Papel">
    <textarea id="notesInput" placeholder="Observa√ß√µes ou detalhes de acompanhamento"></textarea>
    <button onclick="addParticipant()">Adicionar</button>
  </div>

  <div class="section">
    <h2>üìù Anota√ß√µes R√°pidas</h2>
    <textarea id="quickNotes" placeholder="Escreva aqui notas..." rows="6"></textarea><br>
    <button onclick="saveNotes()">Salvar Anota√ß√µes</button>
  </div>

  <div class="section" style="text-align:center;">
    <h2>üì¶ Gerenciar Dados (Local)</h2>
    <button onclick="resetDatabase()">üßπ Resetar Dados Locais</button>
    <p>Para salvar mudan√ßas no Git, use o painel de Gerenciamento de Conte√∫do.</p>
  </div>
</div>

<!-- Modal da chave -->


<script>
const tableBody=document.querySelector("#participantsTable tbody");
let participants=[];
let sessionPassword=null;

// === Criptografia (Removida) ===


// === Dados ===
function renderTable(){
  tableBody.innerHTML="";
  participants.forEach(p=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${p.name}</td><td>${p.role}</td><td>${p.notes}</td>`;
    tableBody.appendChild(tr);
  });
}
function addParticipant(){
  const name=document.getElementById("nameInput").value.trim();
  const role=document.getElementById("roleInput").value.trim();
  const notes=document.getElementById("notesInput").value.trim();
  if(!name)return alert("Insira o nome.");
  participants.push({name,role,notes});
  renderTable();
  document.getElementById("nameInput").value="";
  document.getElementById("roleInput").value="";
  document.getElementById("notesInput").value="";
}
// Client-side save removed. Data is managed by Netlify CMS.
function saveLocalFallback(){
  const data={participants,notes:document.getElementById("quickNotes").value};
  localStorage.setItem("localDB", JSON.stringify(data));
}
function saveNotes(){
  saveLocalFallback();
  alert("Anota√ß√µes salvas localmente. Para salvar no Git, use o Gerenciamento de Conte√∫do.");
}
async function exportData(){
  alert("Exporta√ß√£o de dados removida. Use o Gerenciamento de Conte√∫do para gerenciar dados.");
}
async function importData(event){
  alert("Importa√ß√£o de dados removida. Use o Gerenciamento de Conte√∫do para gerenciar dados.");
}
function resetDatabase(){
  if(confirm("Tem certeza que deseja apagar todos os dados locais? Esta a√ß√£o n√£o pode ser desfeita.")){
    localStorage.removeItem("localDB");
    participants=[];
    document.getElementById("quickNotes").value="";
    renderTable();
    alert("Banco de dados local apagado com sucesso!");
  }
}

// === Tema ===
function toggleDarkMode(){
  document.body.classList.toggle("dark");
  localStorage.setItem("darkMode",document.body.classList.contains("dark"));
}
if(localStorage.getItem("darkMode")==="true")document.body.classList.add("dark");

// === Carregamento de Dados do Git ===
const DB_KEY_USERS='dados_users-10.json'; // Assuming this is the main file for users based on the other files

async function loadUsersFromGit(){
  try{
    const response = await fetch(DB_KEY_USERS);
    if (!response.ok) throw new Error(\`Failed to fetch \${DB_KEY_USERS}\`);
    const data = await response.json();
    participants = data.participants || [];
    document.getElementById("quickNotes").value = data.notes || "";
    renderTable();
    alert("Dados carregados do Git com sucesso!");
  }catch(error){
    console.error("Erro ao carregar dados do Git:", error);
    alert("Erro ao carregar dados do Git. Verificando dados locais...");
    // Fallback to local storage
    const stored = localStorage.getItem("localDB");
    if(stored){
      try{
        const localData = JSON.parse(stored);
        participants = localData.participants || [];
        document.getElementById("quickNotes").value = localData.notes || "";
        renderTable();
        alert("Dados carregados do LocalStorage (falha no Git).");
      }catch{
        participants = [];
        document.getElementById("quickNotes").value = "";
        alert("Novo banco de dados criado.");
      }
    } else {
      participants = [];
      document.getElementById("quickNotes").value = "";
      alert("Novo banco de dados criado.");
    }
  }
}

// === Foco inicial e tecla ENTER ===
window.addEventListener("load", loadUsersFromGit);
</script>

</body>
</html>
