<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>USERS - iectta v10</title>
<style>
  body{font-family:Arial,sans-serif;background-color:var(--bg);color:var(--fg);margin:0;padding:0;transition:.3s;}
  :root{--bg:#0d1117;--fg:#e6edf3;--card:#161b22;--accent:#58a6ff;}
  body.light{--bg:#fff;--fg:#111;--card:#f2f2f2;--accent:#0077ff;}
  header{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;background-color:var(--card);}
  h1{margin:0;font-size:1.3rem;}
  button,select,textarea,input{background-color:var(--card);color:var(--fg);border:1px solid var(--accent);border-radius:6px;padding:6px 10px;margin:4px;}
  button:hover{background-color:var(--accent);color:#fff;}
  textarea{width:100%;min-height:80px;}
  .container{padding:1rem;max-width:900px;margin:auto;}
  .statusbar{position:fixed;bottom:0;left:0;right:0;background-color:var(--card);color:var(--fg);text-align:center;padding:.4rem;font-size:.9rem;}
  .list{margin-top:1rem;}
  .list-item{background-color:var(--card);padding:.7rem;border-radius:6px;margin-bottom:.5rem;cursor:pointer;}
  .func-row{display:flex;align-items:center;gap:8px;}
</style>
</head>
<body>
<header>
  <h1>USERS - iectta v10</h1>
  <div>
    <button id="toggleTheme">üåó Tema</button>
    <a href="/admin/" style="text-decoration:none;"><button>‚öôÔ∏è Gerenciar Conte√∫do</button></a>
    
    
  </div>
</header>

<div class="container">
  <label>Nome:</label>
  <input type="text" id="nomeInput" placeholder="Digite o nome"/><br/>
  <label>Fun√ß√£o/Papel:</label>
  <div class="func-row">
    <input type="text" id="funcaoTextbox" placeholder="Selecione fun√ß√µes..." style="flex:1"/>
    <select id="funcaoSelect"></select>
  </div>
  <label>Observa√ß√µes:</label>
  <textarea id="obsArea"></textarea>
  <div>
    <button id="addBtn">‚ûï Adicionar</button>
    <button id="editBtn">‚úèÔ∏è Editar</button>
    <button id="deleteBtn">üóëÔ∏è Apagar</button>
    <button id="saveBtn">üíæ Salvar</button>
  </div>
  <div class="list" id="listContainer"></div>
</div>
<div class="statusbar" id="statusBar">Pronto.</div>

<script>
const body=document.body,themeBtn=document.getElementById('toggleTheme');
body.classList.toggle('light',localStorage.getItem('theme')==='light');
themeBtn.onclick=()=>{body.classList.toggle('light');localStorage.setItem('theme',body.classList.contains('light')?'light':'dark');};
function status(msg){document.getElementById('statusBar').textContent=msg;}
let users=[];
loadUsersFromGit();

// ==== Carregar CSV de fun√ß√µes ====
async function carregarFuncoes(){
  try{
    const r=await fetch('fun√ß√µes.csv');
    const text=await r.text();
    const linhas=text.split(/\r?\n/).filter(l=>l.trim().length>0);
    const sel=document.getElementById('funcaoSelect');
    sel.innerHTML='<option value="">-- selecione --</option>'+linhas.map(l=>`<option>${l.trim()}</option>`).join('');
    status('Fun√ß√µes carregadas de fun√ß√µes.csv.');
  }catch(e){status('Erro ao carregar fun√ß√µes.csv');}
}
carregarFuncoes();

// ==== Combobox adiciona ao textbox ====
document.getElementById('funcaoSelect').onchange=()=>{
  const sel=document.getElementById('funcaoSelect');
  const val=sel.value.trim();
  const tb=document.getElementById('funcaoTextbox');
  if(!val)return;
  let atual=tb.value.split(',').map(v=>v.trim()).filter(Boolean);
  if(!atual.includes(val)){atual.push(val);tb.value=atual.join(', ');}
  sel.value="";
};

// ==== Render ====
function renderList(){
  const list=document.getElementById('listContainer');
  list.innerHTML=users.map((u,i)=>`<div class="list-item" onclick="selecionar(${i})">${u.Nome} - ${u.Fun√ß√£o}</div>`).join('');
}
let selecionado=-1;
window.selecionar=(i)=>{
  selecionado=i;
  const u=users[i];
  document.getElementById('nomeInput').value=u.Nome;
  document.getElementById('funcaoTextbox').value=u.Fun√ß√£o;
  document.getElementById('obsArea').value=u.Observa√ß√µes;
  status('Usu√°rio selecionado: '+u.Nome);
};

// ==== CRUD ====
document.getElementById('addBtn').onclick=()=>{
  const nome=document.getElementById('nomeInput').value.trim();
  const funcao=document.getElementById('funcaoTextbox').value.trim();
  const obs=document.getElementById('obsArea').value;
  if(!nome)return status('Informe o nome.');
  users.push({Nome:nome,Fun√ß√£o:funcao,Observa√ß√µes:obs});
  renderList();status('Usu√°rio adicionado.');
};
document.getElementById('editBtn').onclick=()=>{
  if(selecionado<0)return;
  users[selecionado]={Nome:document.getElementById('nomeInput').value.trim(),
                      Fun√ß√£o:document.getElementById('funcaoTextbox').value.trim(),
                      Observa√ß√µes:document.getElementById('obsArea').value};
  renderList();status('Usu√°rio editado.');
};
document.getElementById('deleteBtn').onclick=()=>{
  if(selecionado<0)return;
  users.splice(selecionado,1);
  selecionado=-1;
  renderList();status('Usu√°rio removido.');
};
document.getElementById('saveBtn').onclick=()=>{
  status('Aviso: O bot√£o Salvar localmente foi desativado. Use o Gerenciamento de Conte√∫do para salvar no Git.');
};

// Export/Import functionality removed. Data is managed by Netlify CMS.

// Client-side encryption/decryption removed. Data is managed by Netlify CMS.

// ==== Carregamento de Dados do Git ====
const DB_KEY_USERS_10='dados_users_encrypted.json';

async function loadUsersFromGit(){
  try{
    const response = await fetch(DB_KEY_USERS_10);
    if (!response.ok) throw new Error(\`Failed to fetch \${DB_KEY_USERS_10}\`);
    const data = await response.json();
    users = data.dados_users || [];
    renderList();
    status('Dados carregados do Git com sucesso.');
  }catch(error){
    console.error("Erro ao carregar dados do Git:", error);
    status('‚ùå Erro ao carregar dados do Git. A edi√ß√£o deve ser feita pelo CMS.');
  }
}
loadUsersFromGit();
</script>
</body>
</html>